sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","../model/formatter","../model/individualFormatter"],function(e,t,i,n,s,r,o,a){"use strict";return e.extend("com.mjzsoft.UserSurveys.controller.Master",{formatter:a,onInit:function(){var e=this.byId("list"),t=this._createViewModel(),i=e.getBusyIndicatorDelay();this.setModel(t,"masterView");e.attachEventOnce("updateStarted",function(){t.setProperty("/delay",i);var e=this.getOwnerComponent().getCurrentUser();if(e){if(!e.admin){var s=new n("Email",r.EQ,e.email);this.byId("list").getBinding("items").filter(s,"Application")}}else{var s=new n("Id",r.EQ,"-1");this.byId("list").getBinding("items").filter(s,"Application")}}.bind(this));this.getView().addEventDelegate({onBeforeFirstShow:function(){this.getOwnerComponent().oListSelector.setBoundMasterList(e)}.bind(this)});this.getRouter().getRoute("master").attachPatternMatched(this._onMasterMatched,this);this.getRouter().attachBypassed(this.onBypassed,this)},onUpdateFinished:function(e){this._updateListItemCount(e.getParameter("total"))},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");this._applyFilterSearch(t)},liveSearch:function(e){if(e.getParameters().newValue.length===0){this._applyFilterSearch()}},_applyFilterSearch:function(e){var t=this.getView().byId("list").getBinding("items");var i;if(e){var s=[new n("FirstName",r.Contains,e),new n("LastName",r.Contains,e)];var o=this.getOwnerComponent().getCurrentUser();if(o){if(!o.admin){s.push(new n("Email",r.EQ,o.email))}}else{s.push(new n("Id",r.EQ,"-1"))}i=new n({filters:s,and:false})}else{i=[]}t.filter(i,"control")},onRefresh:function(){this.byId("list").getBinding("items").refresh()},onOpenViewSettings:function(e){var t="filter";if(e.getSource()instanceof sap.m.Button){var i=e.getSource().getId();if(i.match("sort")){t="sort"}else if(i.match("group")){t="group"}}if(!this.byId("viewSettingsDialog")){o.load({id:this.getView().getId(),name:"com.mjzsoft.UserSurveys.view.ViewSettingsDialog",controller:this}).then(function(e){this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open(t)}.bind(this))}else{this.byId("viewSettingsDialog").open(t)}},onConfirmViewSettingsDialog:function(e){this._applySortGroup(e)},_applySortGroup:function(e){var t=e.getParameters();var i=t.sortItem.getKey();var n=t.sortDescending;var r=[new s(i,n)];this.byId("list").getBinding("items").sort(r)},onSelectionChange:function(e){var t=e.getSource(),i=e.getParameter("selected");if(!(t.getMode()==="MultiSelect"&&!i)){this._showDetail(e.getParameter("listItem")||e.getSource())}},onBypassed:function(){this.byId("list").removeSelections(true)},onNavBack:function(){var e=i.getInstance().getPreviousHash(),t=sap.ushell.Container.getService("CrossApplicationNavigation");if(e!==undefined||!t.isInitialNavigation()){history.go(-1)}else{t.toExternal({target:{shellHash:"#Shell-home"}})}},_createViewModel:function(){return new t({delay:0,title:this.getResourceBundle().getText("masterTitleCount",[0])})},_onMasterMatched:function(){this.getModel("appView").setProperty("/layout","OneColumn")},_showDetail:function(e){var t=!sap.ui.Device.system.phone;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Id")},t)},_updateListItemCount:function(e){if(this.byId("list").getBinding("items").isLengthFinal()){var t=this.getResourceBundle().getText("masterTitleCount",[e]);this.getModel("masterView").setProperty("/title",t)}}})});