sap.ui.define([],function(){"use strict";var e=null,n=[],t=jQuery.sap.storage(jQuery.sap.storage.Type.session),r=jQuery.sap.storage(jQuery.sap.storage.Type.local),i=function(n,t,i,u,s){var a=e;sap.ui.core.BusyIndicator.show(1e3);jQuery.ajax({type:n,contentType:"application/json; charset=utf-8",pathInfo:null,data:n==="POST"?JSON.stringify(i):i,url:r.get("JwtServerUrl")+t,headers:{Authorization:a},cache:false,async:false,success:function(e,n,t){sap.ui.core.BusyIndicator.hide();if(typeof u==="function"){u(e,n,t)}},error:function(e,n,t){sap.ui.core.BusyIndicator.hide();if(typeof s==="function"){s(e,n,t)}}})},u=function(e,n,t,r){i("GET",e,n,t,r)},s=function(){var e=t.get("CurrentToken");return e!==null?JSON.parse(e):null},a=function(t){var r=n[t];r.setHeaders({Authorization:e})},o=function(){for(var e in n){if(e){a(e)}}},f=function(e){var t=n[e];t.setHeaders({Authorization:null})},c=function(){var n=s();if(n!==null&&n.expireAt>(new Date).getTime()){var r=n.tokenType+n.accessToken;if(r!==e){e=r}}else{t.clear();e=null}o()};c();sap.ui.getCore().getEventBus().subscribe("JWT","jwtChanged",c,this);var l={hasSession:function(n){var r=s();if(r!==null&&r.expireAt>(new Date).getTime()){e=r.tokenType+r.accessToken;if(typeof n==="function"){n(true)}return true}else{t.clear();e=null;if(typeof n==="function"){n(false)}return false}},addModel:function(e,t){n[t]=e;a(t)},removeModel:function(e){if(n[e]!==undefined){f(e);delete n[e]}},getCurrentUser:function(){var e=null;if(this.hasSession()){var n=t.get("CurrentUser");if(n===null){u(r.get("JwtUserEndpoint"),null,function(n,r,i){t.put("CurrentUser",JSON.stringify(n));e=n})}else{e=JSON.parse(n)}}return e}};return l});