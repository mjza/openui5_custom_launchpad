sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox","../js/XML2JSON"],function(e,s,r){"use strict";return e.extend("com.mjzsoft.QuestionnaireStatistics.controller.ErrorHandler",{constructor:function(e){this._oResourceBundle=e.getModel("i18n").getResourceBundle();this._oComponent=e;this._oModel=e.getModel();this._bMessageOpen=false;this._sErrorText=this._oResourceBundle.getText("errorText");this._oModel.attachMetadataFailed(function(e){var s=e.getParameters();this._showServiceError(s.response)},this);this._oModel.attachRequestFailed(function(e){var s=e.getParameters();if(s.response.statusCode!=="404"||s.response.statusCode===404&&s.response.responseText.indexOf("Cannot POST")===0){this._showServiceError(s.response)}},this)},_showServiceError:function(e){if(this._bMessageOpen){return}try{var t=JSON.parse(e.responseText);try{var o=t.error.innererror.errordetails,n=e.statusText+" ("+e.statusCode+") <br/>";for(var a=0;a<o.length;a++){n+="<br/> Code("+o[a].code+") : "+o[a].message}if(o.length===0){n+=t.error.message.value}var i=t.error.innererror.Error_Resolution;if(i&&i.SAP_Transaction){n+="<br/>"+i.SAP_Transaction}}catch(s){n=e.statusText+" ("+e.statusCode+") <br/>"+t.error.message.value}}catch(s){var c=new r.X2JS;t=c.xml_str2json(e.responseText);try{n=e.statusText+" ("+e.statusCode+") \n\n"+t.error.message.__text;n+="<br/><br/>"+t.error.innererror.Error_Resolution.SAP_Transaction}catch(s){n=e.statusText+" ("+e.statusCode+") \n\n"+e.responseText}}this._bMessageOpen=true;var u=parseInt(e.statusCode,10);if(u<500&&u>=400){s.error(this._oResourceBundle.getText("error400TypeResponse"),{id:"serviceErrorMessageBox",details:n?n:e,icon:s.Icon.WARNING,styleClass:this._oComponent.getContentDensityClass(),actions:[s.Action.CLOSE],onClose:function(){this._bMessageOpen=false}.bind(this)})}else{s.error(this._oResourceBundle.getText("errorResponse"),{id:"serviceErrorMessageBox",details:n?n:e,icon:s.Icon.WARNING,styleClass:this._oComponent.getContentDensityClass(),actions:[s.Action.CLOSE],onClose:function(){this._bMessageOpen=false}.bind(this)})}}})});