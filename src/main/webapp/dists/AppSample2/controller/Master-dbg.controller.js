sap.ui.define(["com/mjzsoft/QuestionnaireStatistics/controller/BaseController","com/mjzsoft/QuestionnaireStatistics/model/models","com/mjzsoft/QuestionnaireStatistics/model/formatter","sap/ui/core/routing/History","sap/ui/Device","com/mjzsoft/QuestionnaireStatistics/model/individualFormatter"],function(e,t,s,i,r){"use strict";return e.extend("com.mjzsoft.QuestionnaireStatistics.controller.Master",{formatter:s,onInit:function(){var e=t.initMasterViewModel(this);this.setModel(e,"masterView");this.getRouter().getRoute("master").attachMatched(this._onMasterMatched,this);var s=sap.ui.getCore().getEventBus();s.subscribe("_refreshMasterSelection","formId",this._refreshMasterSelection,this);s.subscribe("_deselectMasterSelection","detailClose",this._deselectMasterSelection,this)},onExit:function(){var e=sap.ui.getCore().getEventBus();e.unsubscribe("_refreshMasterSelection","formId",this._refreshMasterSelection,this);e.unsubscribe("_deselectMasterSelection","detailClose",this._deselectMasterSelection,this)},onFormsReceived:function(e){var t=e.getSource(),s=this.getModel("masterView");s.setProperty("/masterCounterTitle",this.getResourceBundle().getText("TxtNumberResources",[t.getLength()]));if(t.getLength()===0){s.setProperty("/showNoDataMessage",true)}else{s.setProperty("/showNoDataMessage",false)}},handleSearch:function(e){this.onSearch(e,"query")},liveSearch:function(e){if(e.getParameters().newValue.length===0){this.onSearch(e,"newValue")}},onSearch:function(e,t){if(e.getParameters().refreshButtonPressed){this.getView().byId("flexboxId").getBinding("items").refresh();return}var s=e.getParameter(t);var i=[];if(s){i=[new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,s)]}var r=this.getView().byId("flexboxId");r.getBinding("items").filter(i)},onNavBack:function(){var e=i.getInstance().getPreviousHash(),t=sap.ushell.Container.getService("CrossApplicationNavigation");if(e!==undefined||!t.isInitialNavigation()){history.go(-1)}else{t.toExternal({target:{shellHash:"#Shell-home"}})}},onPressItem:function(e){var t=!r.system.phone,s=e.getSource().getBindingContext();var i=this.getModel().getProperty(s.sPath);this.getRouter().navTo("object",{objectId:i.Id},t);var o=e.getSource().getParent().getItems();o.forEach(function(e){e.removeStyleClass("selectedTileItem")});e.getSource().addStyleClass("selectedTileItem");this.getModel("appView").setProperty("/flexBoxDirection","Column");this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded")},_onMasterMatched:function(){if(!this.getOwnerComponent().getCurrentUser()||!this.getOwnerComponent().getCurrentUser().admin){this.getRouter().navTo("notAllowed",{},true);this.getModel("appView").setProperty("/layout","OneColumn")}else{this.getModel().refresh(true);this.getModel("appView").setProperty("/flexBoxDirection","Row");this.getModel("appView").setProperty("/layout","OneColumn")}},_refreshMasterSelection:function(e,t,s){var i=this.getView().byId("flexboxId");var r=i.getItems();if(r.length===0){i.getBinding("items").attachEventOnce("dataReceived",function(){r=i.getItems();this._setSelectedItem(r,s.formId)}.bind(this))}else{this._setSelectedItem(r,s.formId)}sap.ui.getCore().getEventBus().unsubscribe("_refreshMasterSelection","formId",this._refreshMasterSelection,this)},_setSelectedItem:function(e,t){t=parseInt(t,10);var s=e.find(function(e){var s=e.getBindingContext().sPath;var i=this.getView().getModel().getProperty(s);return i.Id===t}.bind(this));var i=this.getAppViewModel();if(s){s.addStyleClass("selectedTileItem");i.setProperty("/flexBoxDirection","Column")}else{i.setProperty("/flexBoxDirection","Row");i.setProperty("/layout","OneColumn");i.setProperty("/datesChanged",false)}},_deselectMasterSelection:function(){var e=this.getView().byId("flexboxId");var t=e.getItems();t.forEach(function(e){e.removeStyleClass("selectedTileItem")})}})});