sap.ui.define(["com/mjzsoft/Mjzsoft0Launchpad/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,t,r){"use strict";return e.extend("com.mjzsoft.Mjzsoft0Launchpad.controller.Password",{model:{resetToken:undefined,newPass:undefined,confirmNewPass:undefined,passConfirmed:false,success:null,error:null,lang:"en"},onInit:function(){var e=sap.ui.getCore().getConfiguration().getLanguage();e=e&&e.length>=2?e.substring(0,2):"en";this.model.lang=e;this.setModel(new t(this.model),"passwordView");this.initiateValidator()},onBeforeRendering:function(t){e.prototype.onBeforeRendering(t);if(this._readToken()){sap.ui.getCore().getEventBus().publish("App","StartAppBusy",null);var r=this.getOwnerComponent().getTargets();r.display("TargetLogin");return}},onAfterRendering:function(t){e.prototype.onAfterRendering(t);this.bindOnChangeToInputs("Password");this.getValidator().removeAllMessages()},_readToken:function(){var e=""+window.location.href;var t=/([?&]password-reset-token)=([^#&]*)/g;var r=t.exec(e);var n=true;if(r&&r.length>0){var s=r[2];if(s!=="0"){t=/([?&]token)=([^#&]*)/g;r=t.exec(e);if(r&&r.length>0){var o=r[2];this.model.resetToken=o;n=false}}}return n},getViewModel:function(){return this.getModel("passwordView")},onLanguageChange:function(e){sap.ui.getCore().getEventBus().publish("App","StartAppBusy",null);var t=e.getSource().getSelectedKey();var r=""+window.location.href,n=r;var s=/([?&]sap-language)=([^#&]*)/g;var o=s.exec(r);if(o&&o.length>0){n=r.replace(s,o[1]+"="+t)}else if(r.indexOf("?")>0){n=r.replace("?","?sap-language="+t+"&")}else{n=r.replace("index.html","index.html?sap-language="+t+"&")}sap.m.URLHelper.redirect(n,false)},onConfirmPassChanged:function(e){var t=this.getViewModel(),r=t.getProperty("/newPass"),n=t.getProperty("/confirmNewPass");if(r!==n){t.setProperty("/passConfirmed",false)}else{t.setProperty("/passConfirmed",true)}},onPasswordResetButtonPress:function(){var e=this.getViewModel(),t=e.getProperty("/resetToken"),r=e.getProperty("/newPass"),n=e.getProperty("/confirmNewPass"),s=this.getView().byId("confirmNewPass");if(!this.areFieldsValid("Password")){return}if(!e.getProperty("/passConfirmed")){s.setValueState(sap.ui.core.ValueState.Error);return}s.setValueState(sap.ui.core.ValueState.None);sap.ui.getCore().getEventBus().publish("App","StartAppBusy",null);e.setProperty("/success",null);e.setProperty("/error",null);this.getOwnerComponent().getJwtAuth().resetPassword(r,n,t,function(e,t,r){sap.ui.getCore().getEventBus().publish("App","StartAppBusy",null);var n=""+window.location.href,s=n;var o=/([?&]password-reset-token)=([^#&]*)/g;var a=o.exec(n);if(a&&a.length>0){s=n.replace(o,a[1]+"=0")}o=/([?&]token)=([^#&]*)/g;a=o.exec(n);if(a&&a.length>0){s=s.replace(o,a[1]+"=0")}document.location.replace(s)}.bind(this),function(t,r,n){sap.ui.getCore().getEventBus().publish("App","StopAppBusy",null);var s=this.extractErrorMessage(t,r,n);e.setProperty("/error",s)}.bind(this))},onSuccessStripClosed:function(e){this.getViewModel().setProperty("/success",null)},onErrorStripClosed:function(e){this.getViewModel().setProperty("/error",null)},onRejectButtonPress:function(){var e=this.getOwnerComponent().getTargets();e.display("TargetLogin")}})});